<DocPage toc={[
  { title: "Current State", url: "#current-state", depth: 2 },
  { title: "Features", url: "#features", depth: 2 },
  { title: "How It Works", url: "#how-it-works", depth: 2 },
  { title: "Architecture Overview", url: "#architecture-overview", depth: 2 },
  { title: "Quick Example", url: "#quick-example", depth: 2 },
  { title: "Next Steps", url: "#next-steps", depth: 2 },
]}>

# Introduction

ConvexBooking is an open-source, real-time booking system built as a [Convex component](https://docs.convex.dev/components). It provides everything you need to add booking functionality to your application.

<Callout type="info">
  **Now Available on npm!**

  Install with `npm install @mrfinch/booking` and add real-time booking to your Convex app in minutes.
</Callout>

## Current State

**What works:**
- Real-time booking flow with presence-based slot locking
- Admin UI for managing resources, schedules, and event types
- Multi-duration support (30min, 1h, 2h, 5h)
- Multi-resource booking with add-ons
- O(1) availability queries that scale
- npm package for easy installation

**Not ready yet:**
- CLI scaffolding tool
- Comprehensive test coverage

**How to use:**
1. **Install packages:** `npm install @mrfinch/booking @convex-dev/workos-authkit`
2. **Configure components:** Mount both components in `convex/convex.config.ts`
3. **Set up authentication:** Create `convex/authClient.ts`, `convex/http.ts`, and `convex/functions.ts`
4. **Create API gateways:** Define trust zones in `convex/public.ts` and `convex/admin.ts`
5. **Configure environment:** Set WorkOS and Resend API keys
6. **Use components:** Add `<Booker />` to your frontend with `AuthKitProvider`

Or [fork the demo repo](https://github.com/Finchmedia/convex-booking) for full customization with Admin UI included.

See the [Quick Start](/docs/getting-started) for detailed instructions.

## Features

- **Real-time Presence** - Slot locking prevents double bookings. Other users see reserved slots instantly.
- **Multi-Duration Support** - Flexible booking lengths (30min, 1h, 2h, 5h) with intelligent conflict detection.
- **O(1) Availability Queries** - Scales to millions of bookings using discrete time buckets.
- **ACID Transactions** - Race-condition free bookings with Convex's transactional guarantees.
- **Multi-Resource Booking** - Book rooms, equipment, or people. Resources can be bundled or standalone.
- **Flexible Schedules** - Define availability windows, date overrides, and buffer times.

## How It Works

ConvexBooking uses a **discrete time bucket** architecture where availability is pre-computed and stored in 15-minute intervals (called "quanta"). This enables O(1) availability checks regardless of how many historical bookings exist.

```typescript title="convex/booking.ts"
// Check availability - always O(1), even with millions of bookings
const slots = await ctx.runQuery(api.booking.getDaySlots, {
  resourceId: "studio-a",
  date: "2025-01-15",
  duration: 60, // minutes
});
```

The real-time presence system uses heartbeats to temporarily hold slots while users are selecting them, preventing double-booking scenarios.

## Architecture Overview

The system is organized in four layers:

**Your App** — The frontend you build
- `<Booker />` component (calendar, time slots, booking form)
- Admin Dashboard (resource management, schedule configuration, booking management)
- `AuthKitProvider` for authentication

**API Gateways** — Authorization layer with trust zones
- `convex/public.ts` — Public booking functions (unauthenticated)
- `convex/admin.ts` — Admin functions (requires authentication)
- `convex/functions.ts` — Helper utilities for auth checks
- Pattern: Each gateway wraps component functions with appropriate authorization logic

**ConvexBooking Component** — The reusable booking logic
- **Resources** — Bookable entities (rooms, equipment, people)
- **Schedules** — Availability windows and business hours
- **Event Types** — Booking templates with durations and rules
- **Bookings** — Confirmed reservations
- **Presence** — Real-time slot locking via heartbeats
- **Availability** — Pre-computed time buckets for O(1) queries
- **Resend (nested)** — Email notifications via component hooks

**Convex** — The backend platform
- Real-time subscriptions, ACID transactions, serverless functions
- WorkOS AuthKit component for authentication and webhooks

## Quick Example

```tsx title="app/book/page.tsx"
import { Booker } from "@mrfinch/booking/react";

export default function BookingPage() {
  return (
    <Booker
      eventTypeId="studio-session"
      resourceId="studio-a"
      title="Book a Session"
      description="Select a time that works for you"
    />
  );
}
```

## Next Steps

- [Quick Start](/docs/getting-started) - Get ConvexBooking running in minutes
- [Core Concepts](/docs/concepts) - Understand the architecture and data model
- [Components](/docs/components) - Learn about the Booker and Admin UI
- [API Reference](/docs/api) - Full API documentation

</DocPage>
